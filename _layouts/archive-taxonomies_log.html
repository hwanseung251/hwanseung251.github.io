---
layout: default
---


<h1>{{ page.title }}</h1>

{% comment %} Check the type of archive {% endcomment %}
{%- if page.type == 'categories' -%}
  {%- assign taxonomies = site.categories -%}
{%- elsif page.type == 'tags' -%}
  {%- assign taxonomies = site.tags -%}
{%- elsif page.type == 'logs' -%}
  {%- assign filtered_posts = site.posts | where_exp: "post", "post.path contains '/log_post/'" -%}
  {%- assign all_logs = "" | split: "," -%}
  {%- for post in filtered_posts -%}
    {%- if post.logs -%}
      {%- for log in post.logs -%}
        {%- assign all_logs = all_logs | push: log -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign unique_logs = all_logs | uniq -%}
  {%- assign taxonomies = "" | split: "," -%}
  {%- for log_name in unique_logs -%}
    {%- assign posts_with_log = filtered_posts | where_exp: "post", "post.logs contains log_name" -%}
    {%- assign taxonomy_entry = log_name | append: "|" | append: posts_with_log.size -%}
    {%- for post in posts_with_log -%}
      {%- assign taxonomy_entry = taxonomy_entry | append: "|" | append: post.title | append: "|" | append: post.url | append: "|" | append: post.date -%}
    {%- endfor -%}
    {%- assign taxonomies = taxonomies | push: taxonomy_entry -%}
  {%- endfor -%}
{%- else -%}
  {%- assign taxonomies = none -%}
{%- endif -%}

{% comment %} Calculate the max count of taxonomies {% endcomment %}
{%- assign max_count = 0 -%}
{%- for taxonomy in taxonomies -%}
  {%- assign posts = taxonomy[1] -%}
  {%- if posts.size > max_count -%}
    {%- assign max_count = posts.size -%}
  {%- endif -%}
{%- endfor -%}

<div class="taxonomies-wrapper">
  <ul class="taxonomies">
    {%- for i in (1..max_count) reversed -%}
      {%- for taxonomy in taxonomies -%}
        {%- assign taxonomy_name = taxonomy[0] -%}
        {%- assign slugified_taxonomy_name = taxonomy_name | slugify -%}
        {%- assign posts = taxonomy[1] -%}
        {%- if posts.size == i -%}
          <li>
            {%- capture link -%}{{ page.permalink }}#{{ slugified_taxonomy_name }}{%- endcapture -%}
            <a class="taxonomy" href="{{ link | relative_url }}">
              <span>
                {%- if page.type == 'tags' -%}
                  {{ slugified_taxonomy_name }}
                {%- else -%}
                  {{ taxonomy_name }}
                {%- endif -%}
              </span>
              <span class="taxonomy-count">{{ posts.size }}</span>
            </a>
          </li>
        {%- endif -%}
      {%- endfor -%}
    {%- endfor -%}
  </ul>
</div>

{% comment %} Show posts by taxonomy {% endcomment %}
{%- for i in (1..max_count) reversed -%}
  {%- for taxonomy in taxonomies -%}
    {%- assign taxonomy_name = taxonomy[0] -%}
    {%- assign slugified_taxonomy_name = taxonomy_name | slugify -%}
    {%- assign posts = taxonomy[1] -%}
    {%- if posts.size == i -%}
      <h2 id="{{ slugified_taxonomy_name }}">
        {%- if page.type == 'tags' -%}
          {{ slugified_taxonomy_name }}
        {%- else -%}
          {{ taxonomy_name }}
        {%- endif -%}
      </h2>
      <ul class="post-list-by-taxonomy">
        {%- for post in posts -%}
          <li>
            <time datetime="{{ page.date | date_to_xmlschema }}">{{ post.date | date: "%Y-%m-%d" }}</time> &raquo; <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
          </li>
        {%- endfor -%}
      </ul>
      <a href="#" onclick="backToTop()" class="back-to-top">Top &#8648;</a>
    {%- endif -%}
  {%- endfor -%}
{%- endfor -%}

<!-- Dynamic logs categorization -->
{%- assign filtered_posts = site.posts | where_exp: "post", "post.path contains '/log_post/'" -%}
{%- assign all_logs = "" | split: "," -%}
{%- for post in filtered_posts -%}
  {%- if post.logs -%}
    {%- for log in post.logs -%}
      {%- assign all_logs = all_logs | push: log -%}
    {%- endfor -%}
  {%- endif -%}
{%- endfor -%}
{%- assign unique_logs = all_logs | uniq -%}

{%- if unique_logs.size > 0 -%}
<div class="taxonomies-wrapper">
  <ul class="taxonomies">
    {%- for log_name in unique_logs -%}
      {%- assign posts_with_log = filtered_posts | where_exp: "post", "post.logs contains log_name" -%}
      <li>
        <a class="taxonomy" href="/logs/#{{ log_name | slugify }}">
          <span>{{ log_name }}</span>
          <span class="taxonomy-count">{{ posts_with_log.size }}</span>
        </a>
      </li>
    {%- endfor -%}
  </ul>
</div>

{%- for log_name in unique_logs -%}
  {%- assign posts_with_log = filtered_posts | where_exp: "post", "post.logs contains log_name" -%}
  <h2 id="{{ log_name | slugify }}">{{ log_name }}</h2>
  <ul class="post-list-by-taxonomy">
    {%- for post in posts_with_log -%}
      <li>
        <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Y-%m-%d" }}</time> &raquo; <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
      </li>
    {%- endfor -%}
  </ul>
  <a href="#" onclick="backToTop()" class="back-to-top">Top &#8648;</a>
{%- endfor -%}
{%- endif -%}

<script>
  function backToTop() {
    const main = document.getElementById("site-main");
    main.scrollTop = 0;
  }
</script>
