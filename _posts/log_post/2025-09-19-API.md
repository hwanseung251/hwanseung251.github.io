---
layout: post
title: 'API로 데이터를 불러와보자'
date: 2025-09-19 22:39 +0800
logs: [WishEasy]
toc: True
---
가장 우선 구현해야하는 주요 기능인 역 내 에스컬레이터 중심 안내 기능을 구현 하기 위해서 필요한 데이터를 찾아보았다
지하철과 관련된 데이터는 서울교통공사, 한국철도공사, TMAP 대중교통 등에서 많이 찾아볼 수 있었고 대부분 API로 이용할 수 있었다.

일단 데이터를 불로오기 전 사전 데이터 설명으로는 정확히 어떤 데이터고 어떻게 사용할 수 있을지 정확히 판단이 불가능했다. 그래서 관련있어보이는 데이터를 모두 일단 불러와서 판단하기로 했다.

## API로 데이터 불러오기
API는 요청(request)과 응답(response)로 구성되어있다.
서울교통공사 서버에 '최단경로 이동정보' 데이터를 응답받기 위한 요청을 해보자.
URL을 만들고 http메서드(GET)을 통해 날릴 것이다.

### URL 만들기
1. `엔드포인트`
    - API마다 고유한 URL경로인 엔드포인트를 가지고 있다.
    - 때문에 도메인에 이 엔드포인트를 연결한다.
      ```
      "https://apis.data.go.kr/B553766/path/getShtrmPath"
      ```

2. `Parameters`
    - 필요에 따라 원하는 데이터를 가져오려면 이 파라미터를 통해 필터링 할 수 있다.
    - API 마다 제공되는 문서(명세서)를 통해 확인하자!
      ```python
      params = {
        "serviceKey": API_KEY,
        "dataType": "JSON",
        "dptreStnNm": "합정",
        "arvlStnNm": "여의도",
        "searchDt": "2025-09-17 20:50:00",
        # "searchType": ,
        # "exclTrfstnNms": , 
        # "thrghStnNms": ,
        # "schInclYn": ,
      }
      ```
    - `API_KEY!`
      - API로 데이터를 불러올 땐, API_KEY를 발급받아야 하는데 유출되지 않도록 .env파일 등으로 잘 관리하자

### GET 요청
데이터를 불러오는 것은 CRUD 중 R에 속하는 조회를 하는 것이다. 때문에 `GET`메서드를 활용해 요청하면 된다
- 만들어논 URL을 GET메서드로 요청하기
  ```python
  response = requests.get(BASE_URL, params=params)
  ```

### 전체 코드
```python
import requests, os
from dotenv import load_dotenv

load_dotenv()
API_KEY = os.getenv("API_KEY") # env로 관리하는 API키 불러오기

BASE_URL = "https://apis.data.go.kr/B553766/path/getShtrmPath" # 도메인과 엔드포인트 

params = {
    "serviceKey": API_KEY,
    "dataType": "JSON",
    "dptreStnNm": "합정",
    "arvlStnNm": "여의도",
    "searchDt": "2025-09-17 20:50:00",
    # "searchType": ,
    # "exclTrfstnNms": , 
    # "thrghStnNms": ,
    # "schInclYn": ,
}

response = requests.get(BASE_URL, params=params)
```


## 문제 상황
`SSLError (SSLV3_ALERT_ILLEGAL_PARAMETER)` 발생

**SSL이란**
SSL(Secure Sockets Layer)은 웹 브라우저나 프로그램이 HTTPS 요청을 보낼 때 데이터가 중간에서 유출되지 않도록 암호화해주는 보안 프로토콜인데 HTTP에 S를 붙인다.


### 원인과 해결방안
HTTPS 요청이 시작되면 SSL/TLS Handshake과정이 진행되는데 이때 서버가 내 요청의 암호화 옵션을 이해하지 못했거나 거부했을때 보통 발생한다고 한다...

서버가 HTTPS 프로토콜을 지원하지 않거나 버전 호환 문제, 인증서 누락 등의 문제가 원인이고 
공공 데이터 API.의 경우 HTTPS가 필수가 아닌 경우가 많기 때문에 SSL/TLS Handshake과정을 진행하지 않도록 
HTTP로 임시 우회해서 해결했다!

### 응답 결과
```JSON
{
    "header": {"resultCode": "00", "resultMsg": "성공"},
    "body": {
        "searchType": "duration",
        "totalDstc": 4505,
        "totalreqHr": 765,
        "totalCardCrg": 1550,
        "trsitNmtm": 1,
        "trfstnNms": [
            {"stnNm": "당산", "dptreLineNm": "2호선", "arvlLineNm": "9호선"}
        ],
        "paths": [
            {
                "dptreStn": {"stnNm": "당산", "lineNm": "9호선"},
                "arvlStn": {"stnNm": "국회의사당", "lineNm": "9호선"},
                "stnSctnDstc": 1500,
                "reqHr": 92,
                "trainno": "E9704",
                "trainDptreTm": "21:10:10",
                "trainArvlTm": None,
                "etrnYn": "Y",
                "nonstopYn": "Y"
            },
            {
                "dptreStn": {"stnNm": "국회의사당", "lineNm": "9호선"},
                "arvlStn": {"stnNm": "여의도", "lineNm": "9호선"},
                "stnSctnDstc": 900,
                "reqHr": 93,
                "trainno": "E9704",
                "trainDptreTm": "21:11:42",
                "trainArvlTm": "21:13:15",
                "etrnYn": "Y",
                "nonstopYn": "N"
            }
        ]
    }
}
```

끝 